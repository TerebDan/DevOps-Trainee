pipeline {
    agent any
    environment {
        SUDO_PASS = credentials('sudo_pass')
    }
    stages {
        stage('Build') {
            steps {
                git branch: 'accu163', credentialsId: 'ssh_key_jenkins', url: 'git@github.com:TerebDan/DevOps-Trainee.git'
                sh 'ansible-playbook -i /var/jenkins_home/workspace/pipeline/accu163/hosts \
                /var/jenkins_home/workspace/pipeline/accu163/accu163.yml \
                --extra-vars "ansible_sudo_pass=${SUDO_PASS}"'            
            }

            post {
                success {
                    sh 'echo "Build: all fine"'
                }
                failure {
                    sh 'echo "Build: fail"'
                }
            }
        }

        stage('Test') {
            steps {
                sh 'rm -rf /var/jenkins_home/workspace/pipeline'
                sh 'echo "Test"'
            }

            post {
                success {
                    sh 'echo "Test: all fine"'
                }

                failure {
                    sh 'echo "Test: error"'
                }
            }
        }
    } 
}
